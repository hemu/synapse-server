<!DOCTYPE html>

<html>
<head>
  <title>test_fixture.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="account.test.html">
                  account.test.js
                </a>
              
                
                <a class="source" href="routes.html">
                  routes.js
                </a>
              
                
                <a class="source" href="test_database.html">
                  test_database.js
                </a>
              
                
                <a class="source" href="test_fixture.html">
                  test_fixture.js
                </a>
              
                
                <a class="source" href="test_server.html">
                  test_server.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>test_fixture.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> SessionState = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../core/session'</span>).SessionState
<span class="hljs-keyword">const</span> Schema = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../db/schema'</span>);

<span class="hljs-keyword">var</span> ObjectID = Schema.ObjectID;

<span class="hljs-keyword">var</span> SRCore = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../core/spaced_repetition'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><strong><em>*</em></strong> User <strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> testUserFBMessenger = {_id: ObjectID(<span class="hljs-string">"5716893a8c8aff3221812148"</span>),
                   name: <span class="hljs-string">"Homer"</span>,
                   email: <span class="hljs-string">"homerjsimpson@faketestemail.com"</span>,
                   facebookMessageID: <span class="hljs-string">"1028279607252642"</span>};
<span class="hljs-keyword">var</span> testUserFBMessenger2 = {_id: ObjectID(<span class="hljs-string">"6716893a8c8aff3221812148"</span>),
                   name: <span class="hljs-string">"Apu"</span>,
                   email: <span class="hljs-string">"apu@faketestemail.com"</span>};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><strong><em>*</em></strong> Category <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> defaultSubject = {
  _id: ObjectID(<span class="hljs-string">"f64c57184a4ef7f0357f9cd6"</span>),
  createdAt : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  order : <span class="hljs-number">1</span>,
  ctype : <span class="hljs-string">"subject"</span>,
  ckey : <span class="hljs-string">"crash-course-biology"</span>,
  weight : <span class="hljs-number">1</span>
};

<span class="hljs-keyword">var</span> defaultUnit = {
  _id : ObjectID(<span class="hljs-string">"0850e4270c2aadd7ccdc1ca1"</span>),
  createdAt : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  order : <span class="hljs-number">1</span>,
  ctype : <span class="hljs-string">"unit"</span>,
  ckey : <span class="hljs-string">"episode-1-carbon"</span>,
  parent : [
    ObjectID(<span class="hljs-string">"f64c57184a4ef7f0357f9cd6"</span>)
  ],
  weight : <span class="hljs-number">1</span>
};

<span class="hljs-keyword">var</span> defaultTopic = {
  _id : ObjectID(<span class="hljs-string">"5e28c07bb4d307d667fe83e8"</span>),
  createdAt : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  order : <span class="hljs-number">1</span>,
  ctype : <span class="hljs-string">"topic"</span>,
  ckey : <span class="hljs-string">"basic"</span>,
  parent : [
    ObjectID(<span class="hljs-string">"f64c57184a4ef7f0357f9cd6"</span>),
    ObjectID(<span class="hljs-string">"0850e4270c2aadd7ccdc1ca1"</span>)
  ],
  weight : <span class="hljs-number">1</span>
};

<span class="hljs-keyword">var</span> defaultConcept = {
  _id : ObjectID(<span class="hljs-string">"7980227254feb46736ca47fd"</span>),
  createdAt : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  order : <span class="hljs-number">1</span>,
  ctype : <span class="hljs-string">"concept"</span>,
  ckey : <span class="hljs-string">"carbon-atomic-weight"</span>,
  parent : [
    ObjectID(<span class="hljs-string">"f64c57184a4ef7f0357f9cd6"</span>),
    ObjectID(<span class="hljs-string">"0850e4270c2aadd7ccdc1ca1"</span>),
    ObjectID(<span class="hljs-string">"5e28c07bb4d307d667fe83e8"</span>)
  ],
  weight : <span class="hljs-number">1</span>,
  globalIndex: <span class="hljs-number">0</span>,
  subjectParent: defaultSubject._id
};

<span class="hljs-keyword">var</span> noteParent = [ObjectID(<span class="hljs-string">"f64c57184a4ef7f0357f9cd6"</span>),
    ObjectID(<span class="hljs-string">"0850e4270c2aadd7ccdc1ca1"</span>),
    ObjectID(<span class="hljs-string">"5e28c07bb4d307d667fe83e8"</span>),
    ObjectID(<span class="hljs-string">"7980227254feb46736ca47fd"</span>)];

<span class="hljs-keyword">var</span> defaultNote = {
  _id : ObjectID(<span class="hljs-string">"9e16c772556579bd6fc6c222"</span>),
  createdAt : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  ctype : <span class="hljs-string">"note"</span>,
  order : <span class="hljs-number">1</span>,
  type : <span class="hljs-string">"info"</span>,
  weight : <span class="hljs-number">1</span>,
  level : <span class="hljs-number">1</span>,
  display : <span class="hljs-string">"&lt;p&gt;Carbon has 6 protons and 6 neutrons in its nucleus. This makes it a relatively small, flexible atom so it is very useful. This helps make carbon fundamental to life. Without carbon all human, plant, and animal life would not be possible. We are all &lt;strong&gt;carbon-based&lt;/strong&gt; lifeforms.&lt;/p&gt;"</span>,
  extra : <span class="hljs-string">""</span>,
  extra_media : <span class="hljs-string">""</span>,
  parent : noteParent,
  ckey : <span class="hljs-string">"proton-neutron-electron"</span>,
  displayRaw : <span class="hljs-string">"Carbon has 6 protons and 6 neutrons in its nucleus. This makes it a relatively small, flexible atom so it is very useful. This helps make carbon fundamental to life. Without carbon all human, plant, and animal life would not be possible. We are all carbon-based lifeforms."</span>    ,
  globalIndex: <span class="hljs-number">0</span>,
  directParent: noteParent[noteParent.length - <span class="hljs-number">1</span>]
};

<span class="hljs-keyword">var</span> defaultNote2 = {
  _id : ObjectID(<span class="hljs-string">"987e8177faf2c2f03c974482"</span>),
  createdAt : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  ctype : <span class="hljs-string">"note"</span>,
  order : <span class="hljs-number">2</span>,
  type : <span class="hljs-string">"recall"</span>,
  weight : <span class="hljs-number">0.5</span>,
  level : <span class="hljs-number">0.2</span>,
  display : <span class="hljs-string">"&lt;p&gt;How many protons and neutrons does carbon have?&lt;/p&gt;"</span>,
  extra : <span class="hljs-string">""</span>,
  extra_media : <span class="hljs-string">""</span>,
  parent : noteParent,
  ckey : <span class="hljs-string">"q-protons-neutrons"</span>,
  displayRaw : <span class="hljs-string">"How many protons and neutrons does carbon have?"</span>,
  hidden : <span class="hljs-string">"6"</span>,
  globalIndex: <span class="hljs-number">1</span>,
  directParent: noteParent[noteParent.length - <span class="hljs-number">1</span>]
};

<span class="hljs-keyword">var</span> defaultNote3 = {
  createdAt : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  ctype : <span class="hljs-string">"note"</span>,
  order : <span class="hljs-number">2</span>,
  type : <span class="hljs-string">"recall"</span>,
  weight : <span class="hljs-number">0.5</span>,
  level : <span class="hljs-number">0.2</span>,
  display : <span class="hljs-string">"&lt;p&gt;Default note 3 question?&lt;/p&gt;"</span>,
  extra : <span class="hljs-string">""</span>,
  extra_media : <span class="hljs-string">""</span>,
  parent : noteParent,
  ckey : <span class="hljs-string">"test-default-3-recall"</span>,
  displayRaw : <span class="hljs-string">"How many protons and neutrons does carbon have?"</span>,
  hidden : <span class="hljs-string">"default note 3 answer"</span>,
  globalIndex: <span class="hljs-number">2</span>,
  directParent: noteParent[noteParent.length - <span class="hljs-number">1</span>]
};

<span class="hljs-keyword">var</span> defaultNote4 = {
  createdAt : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  ctype : <span class="hljs-string">"note"</span>,
  order : <span class="hljs-number">2</span>,
  type : <span class="hljs-string">"recall"</span>,
  weight : <span class="hljs-number">0.5</span>,
  level : <span class="hljs-number">0.2</span>,
  display : <span class="hljs-string">"&lt;p&gt;Default note 4 question?&lt;/p&gt;"</span>,
  extra : <span class="hljs-string">""</span>,
  extra_media : <span class="hljs-string">""</span>,
  parent : noteParent,
  ckey : <span class="hljs-string">"test-default-4-recall"</span>,
  displayRaw : <span class="hljs-string">"How many protons and neutrons does carbon have?"</span>,
  hidden : <span class="hljs-string">"default note 4 answer"</span>,
  globalIndex: <span class="hljs-number">3</span>,
  directParent: noteParent[noteParent.length - <span class="hljs-number">1</span>]
};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Need to store ids of notes that were cloned and inserted.
These will be referenced later in studentNotes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> defaultNote3Ids = [];
<span class="hljs-keyword">var</span> defaultNote4Ids = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><strong><strong><strong><strong><em>**</em></strong></strong></strong></strong> StudentSession <strong><strong><strong><strong>**</strong></strong></strong></strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> defaultSession = {
  userID: ObjectID(<span class="hljs-string">"5716893a8c8aff3221812148"</span>),
  subjects: {
    <span class="hljs-string">"f64c57184a4ef7f0357f9cd6"</span>: {
      noteID: defaultNote._id,
      queueIndex: <span class="hljs-number">0</span>,
      noteQueue: [defaultNote._id, defaultNote2._id],
      state: SessionState.RECALL,
      globalIndex: <span class="hljs-number">0</span>
    }
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><strong><em>*</em></strong> NoteRecord <strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></p>
<ul>
<li>noteID (MongoID)</li>
<li>lastDone (Date)</li>
<li>due (Date)</li>
<li>factor (float)</li>
<li>interval (float)</li>
<li>count (int)</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> dueDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
<span class="hljs-keyword">var</span> lastDoneDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(dueDate);
lastDoneDate.setHours(dueDate.getHours() - <span class="hljs-number">1</span>);

<span class="hljs-keyword">var</span> defaultNoteRecord = {
  userID: testUserFBMessenger._id,
  noteID: defaultNote3._id,
  noteType: defaultNote3.type,
  lastDone: lastDoneDate,
  due: dueDate,
  factor: SRCore.defaultFactor,
  interval: SRCore.defaultInterval,
  count: <span class="hljs-number">1</span>,
  subjectParent: defaultNote3.parent[<span class="hljs-number">0</span>]
};

<span class="hljs-keyword">var</span> defaultNoteRecord2 = {
  userID: testUserFBMessenger._id,
  noteID: defaultNote4._id,
  noteType: defaultNote4.type,
  lastDone: lastDoneDate,
  due: dueDate,
  factor: SRCore.defaultFactor,
  interval: SRCore.defaultInterval,
  count: <span class="hljs-number">1</span>,
  subjectParent: defaultNote4.parent[<span class="hljs-number">0</span>]
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addUsers</span>(<span class="hljs-params">db</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>console.log(“adding users in test database”);
db.user.insert(testUserFBMessenger);
db.user.insert(testUserFBMessenger2);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> testUser = <span class="hljs-keyword">new</span> Schema.User(testUserFBMessenger);
  <span class="hljs-keyword">return</span> testUser.save().then(() =&gt; {
    <span class="hljs-keyword">var</span> testUser2 = <span class="hljs-keyword">new</span> Schema.User(testUserFBMessenger2);
    <span class="hljs-keyword">return</span> testUser2.save();
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cloneObjForBulkWrite</span>(<span class="hljs-params">note, num</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(num).fill().map( () =&gt; {
    <span class="hljs-keyword">return</span> { insertOne: {<span class="hljs-string">"document"</span>: note} };
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addNotes</span>(<span class="hljs-params">db</span>) </span>{
  db.category.insert(defaultSubject);
  db.category.insert(defaultUnit);
  db.category.insert(defaultTopic);
  db.category.insert(defaultConcept);

  db.category.insert(defaultNote);
  db.category.insert(defaultNote2);

  <span class="hljs-keyword">var</span> defNote3Op = db.category.bulkWrite( cloneObjForBulkWrite(defaultNote3, <span class="hljs-number">10</span>) );
  <span class="hljs-keyword">if</span>(defNote3Op.acknowledged) {
    <span class="hljs-keyword">var</span> ids = defNote3Op.insertedIds;
    defaultNote3Ids = <span class="hljs-built_in">Object</span>.keys(ids).map(key =&gt; ids[key]);
  }


  <span class="hljs-keyword">var</span> defNote4Op = db.category.bulkWrite( cloneObjForBulkWrite(defaultNote4, <span class="hljs-number">10</span>) );
  <span class="hljs-keyword">if</span>(defNote4Op.acknowledged) {
    <span class="hljs-keyword">var</span> ids = defNote4Op.insertedIds;
    defaultNote4Ids = <span class="hljs-built_in">Object</span>.keys(ids).map(key =&gt; ids[key]);
  }

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSessions</span>(<span class="hljs-params">db</span>) </span>{
  db.studentsession.insert(defaultSession);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addNoteRecords</span>(<span class="hljs-params">db</span>) </span>{

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDefaultNoteRecord</span>(<span class="hljs-params">note, noteID, dueDate</span>) </span>{
    <span class="hljs-keyword">return</span> {
      userID: testUserFBMessenger._id,
      noteID: noteID,
      noteType: note.type,
      lastDone: lastDoneDate,
      due: dueDate,
      factor: Modules.SRCore.defaultFactor,
      interval: Modules.SRCore.defaultInterval,
      count: <span class="hljs-number">1</span>,
      subjectParent: note.parent[<span class="hljs-number">0</span>]
    }
  }

  <span class="hljs-keyword">var</span> minToMillisecFactor = <span class="hljs-number">60000</span>;
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">10</span>; i++) {
    <span class="hljs-keyword">var</span> newDueDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(dueDate.getTime() + (i<span class="hljs-number">-5</span>) * minToMillisecFactor);
    <span class="hljs-keyword">var</span> newNoteRecord = getDefaultNoteRecord(defaultNote3,
                                               defaultNote3Ids[i],
                                               newDueDate);
    db.studentnote.insert(newNoteRecord);
  }

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">10</span>; i++) {
    <span class="hljs-keyword">var</span> newDueDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(dueDate.getTime() + (i<span class="hljs-number">-5</span>) * minToMillisecFactor);
    <span class="hljs-keyword">var</span> newNoteRecord = getDefaultNoteRecord(defaultNote4,
                                               defaultNote4Ids[i],
                                               newDueDate);
    db.studentnote.insert(newNoteRecord);
  }

}

<span class="hljs-keyword">var</span> Fixture = {

  addAll: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">db</span>) </span>{
    addUsers(db),
    addNotes(db),
    addSessions(db),
    addNoteRecords(db)
  },

  addUsers: addUsers,
  addNotes: addNotes,
  addSessions: addSessions,
  addNoteRecords, addNoteRecords

};

<span class="hljs-built_in">module</span>.exports = Fixture;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
